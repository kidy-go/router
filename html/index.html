<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://unpkg.com/jquery.terminal@2.x.x/js/jquery.terminal.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/jquery.terminal@2.x.x/css/jquery.terminal.min.css"/>
</head>
<body>
  <div id="terminal"></div>

  <table>
    <tr>
      <td valign="top" width="50%">
        <p>Click "Open" to create a connection to the server,
        "Send" to send a message to the server and "Close" to close the connection.
        You can change the message and send multiple times.
        <p>
        <form>
          <button id="open">Open</button>
          <button id="close">Close</button>
          <p><input id="input" type="text" value="Hello world!">
          <button id="send">Send</button>
        </form>
      </td>
      <td valign="top" width="50%">
        <div id="output"></div>
      </td>
    </tr>
  </table>
<script>
    $(function() {
      var ws;
      $('#terminal').terminal((command, term) => {
        if ("open" == command) {
          if (ws) {
            return false;
          }
          ws = new WebSocket("ws://localhost:8997/ws")

          ws.onopen = function(e) {
            term.echo("Logging") 
          }

          ws.onerror = function(e) {
            term.error("ERROR> "+ e.data)
          }
          ws.onmessage = (e) => {
            term.echo("-> " + e.data)
          }
          ws.onclose = function (e) {
            term.echo("Closed.")
          }
          return
        }

        if (!ws) {
          return false
        }

        ws.send(command)

        if ("close" == command) {
          ws.close()
          return
        }
      }, {
        keymap: {
          'CTRL+P': function(e, original) {
            this.echo('my shortcut');
          }
        }
      });
    });

  
  window.addEventListener("load", function(evt) {
      var output = document.getElementById("output");
      var input = document.getElementById("input");
      var ws;
      var print = function(message) {
          var d = document.createElement("div");
          d.innerHTML = message;
          output.appendChild(d);
      };
      document.getElementById("open").onclick = function(evt) {
          if (ws) {
              return false;
          }
          ws = new WebSocket("ws://localhost:8997/ws");
          ws.onopen = function(evt) {
              print("OPEN");
          }
          ws.onclose = function(evt) {
              print("CLOSE");
              ws = null;
          }
          ws.onmessage = function(evt) {
              print("RESPONSE: " + evt.data);
          }
          ws.onerror = function(evt) {
              print("ERROR: " + evt.data);
          }
          return false;
      };
      document.getElementById("send").onclick = function(evt) {
          if (!ws) {
              return false;
          }
          print("SEND: " + input.value);
          ws.send(input.value);
          return false;
      };
      document.getElementById("close").onclick = function(evt) {
          if (!ws) {
              return false;
          }
          ws.close();
          return false;
      };
  });
</script>
</body>
</html>
